---
format:
  dashboard:
    scrolling: true
---

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.getElementById('nav-overview').classList.add('active');
});
</script>

```{r setup, include=FALSE}
source("library.R")
```

# Status

```{r data}
PID <- readRDS("/home/rstudio/Data/object/PID.rds")
```

## Row {height=30%}
### Column
```{r valuebox-1}
#| content: valuebox
#| title: "총 대상자수 (명)"
list(
  icon = "file-person-fill",
  color = "danger",
  value = format(nrow(PID$PID_ONLY), big.mark = ",", scientific = FALSE)
)
```

### Column
```{r valuebox-2}
#| content: valuebox
#| title: "누적검진 (건)"
list(
  icon = "bar-chart",
  color = "secondary",
  value = format(sum(PID$TABLE_N_YEAR$N), big.mark = ",", scientific = FALSE)
)
```

## Row {height=70%}

# Image

## Row {height=30%}
```{r}
list_dcm <- readRDS("/home/rstudio/Data/object/list_dcm.rds")
```

### Column
```{r valuebox-3}
#| content: valuebox
#| title: "ChestPA (개)"

list(
  icon = "file-person-fill",
  color = "primary",
  value = format(nrow(list_dcm$chestpa$dcm), big.mark = ",", scientific = FALSE)
)
```

### Column
```{r valuebox-4}
#| content: valuebox
#| title: "Mammo (개)"


list(
  icon = "bar-chart",
  color = "success",
  value = format(nrow(list_dcm$mammo$dcm), big.mark = ",", scientific = FALSE)
)
```



## Row {height=70%}

### Column

::: {.panel-tabset}

#### ChestPA

::: {.panel-tabset}

##### 센터
```{r}
full_join(list_dcm$chestpa$count$SALUS_CENTER,
          list_dcm$chestpa$count$SALUS_CENTER_YEAR %>%
            pivot_wider(
            names_from = SALUS_YEAR,
            values_from = n),
          by = join_by(SALUS_CENTER)) %>%
  bind_rows(summarise(., across(where(is.numeric), sum),
                      SALUS_CENTER = "Total")) %>% rename(Total = n) %>%
  f_reactable(
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```

##### 날짜_연도_월

```{r}
list_dcm$chestpa$count$SALUS_YEAR_MONTH %>% arrange(SALUS_YEAR) %>%
  pivot_wider(
            names_from = SALUS_YEAR,
            values_from = n) %>%
  arrange(SALUS_MONTH) %>%
  f_reactable(
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```

##### Modality

```{r}
list_dcm$chestpa$count$SALUS_MODALITY %>% left_join(
  list_dcm$chestpa$count$SALUS_UID_MODALITY %>% arrange(n) %>%
  pivot_wider(
    names_from = n,
    values_from = nn
  )
) %>%
  f_reactable(
    columns = list(
      SALUS_MODALITY = colDef(style=f_style_sticky),
      `검사 유형` = colDef(style=f_style_bold),
      n = colDef(style=f_style_bold)
    ),
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```


:::

:::

### Column

::: {.panel-tabset}

#### Mammo

::: {.panel-tabset}

##### 센터
```{r}
full_join(list_dcm$mammo$count$SALUS_CENTER,
          list_dcm$mammo$count$SALUS_CENTER_YEAR %>%
            pivot_wider(
            names_from = SALUS_YEAR,
            values_from = n),
          by = join_by(SALUS_CENTER)) %>%
  bind_rows(summarise(., across(where(is.numeric), sum),
                      SALUS_CENTER = "Total")) %>% rename(Total = n) %>%
  f_reactable(
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```



##### 날짜_연도_월

```{r}
list_dcm$mammo$count$SALUS_YEAR_MONTH %>% arrange(SALUS_YEAR) %>%
  pivot_wider(
            names_from = SALUS_YEAR,
            values_from = n) %>%
  arrange(SALUS_MONTH) %>%
  f_reactable(
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```

##### Modality

```{r}
list_dcm$mammo$count$SALUS_MODALITY %>% left_join(
  list_dcm$mammo$count$SALUS_UID_MODALITY %>% arrange(n) %>%
  pivot_wider(
    names_from = n,
    values_from = nn
  )
) %>%
  f_reactable(
    columns = list(
      SALUS_MODALITY = colDef(style=f_style_sticky),
      `검사 유형` = colDef(style=f_style_bold),
      n = colDef(style=f_style_bold)
    ),
    pagination = FALSE,
    searchable = FALSE,
    filterable = FALSE
  )
```

:::

:::